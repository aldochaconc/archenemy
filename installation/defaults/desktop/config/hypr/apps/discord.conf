#
# Discord & Communication Apps Window Rules
# https://wiki.hyprland.org/Configuring/Window-Rules/
#
# Configuration for Discord, Slack, Signal, Telegram, and other chat applications.
#

# ============================================================================
# DISCORD
# ============================================================================
# Main Discord application

# Discord window behavior
#   - Usually want it tiled for maximum chat space
#   - Can be set to specific workspace for easy access

# Optional: Assign Discord to workspace 9
# windowrule = workspace 9, class:(discord|Discord)

# Discord opacity (subtle transparency)
windowrule = opacity 0.98 0.95, class:(discord|Discord)

# Alternative: No transparency for Discord
# windowrule = opacity 1 1, class:(discord|Discord)

# Discord popups and modals
windowrulev2 = float, class:(discord|Discord), title:(Discord Updater)
windowrulev2 = size 500 400, class:(discord|Discord), title:(Discord Updater)

# ============================================================================
# DISCORD SCREEN SHARING / STREAMING
# ============================================================================
# Screen share window selection
windowrulev2 = float, class:(discord|Discord), title:(Screen Share|Share your screen)
windowrulev2 = size 800 600, class:(discord|Discord), title:(Screen Share|Share your screen)
windowrulev2 = center, class:(discord|Discord), title:(Screen Share|Share your screen)

# Idle inhibit when in voice/video call (prevent sleep)
#   - This is tricky to detect automatically
#   - Alternative: Use Discord's built-in "Game Activity" detection
# windowrule = idleinhibit focus, class:(discord|Discord)

# ============================================================================
# DISCORD ALTERNATIVE CLIENTS
# ============================================================================

# Vesktop (Discord with Vencord)
windowrule = opacity 0.98 0.95, class:(vesktop|Vesktop)
# windowrule = workspace 9, class:(vesktop|Vesktop)

# Discord Canary (beta version)
windowrule = opacity 0.98 0.95, class:(discordcanary)
# windowrule = workspace 9, class:(discordcanary)

# Discord PTB (Public Test Build)
windowrule = opacity 0.98 0.95, class:(discordptb)

# Webcord (open-source Discord client)
windowrule = opacity 0.98 0.95, class:(webcord)

# ============================================================================
# SLACK
# ============================================================================
# Team communication platform

# Slack window behavior
windowrule = opacity 0.98 0.95, class:(Slack|slack)

# Optional: Assign to workspace
# windowrule = workspace 8, class:(Slack|slack)

# Slack popups
windowrulev2 = float, class:(Slack|slack), title:(Preferences|Settings)
windowrulev2 = size 800 600, class:(Slack|slack), title:(Preferences|Settings)

# Slack calls (float for picture-in-picture style)
windowrulev2 = float, class:(Slack|slack), title:(Slack \| .* call)
windowrulev2 = size 400 300, class:(Slack|slack), title:(Slack \| .* call)
windowrulev2 = pin, class:(Slack|slack), title:(Slack \| .* call)

# ============================================================================
# SIGNAL
# ============================================================================
# Secure messaging app

windowrule = opacity 0.98 0.95, class:(signal|Signal)

# Optional: Float Signal for a chat-app feel
# windowrule = float, class:(signal|Signal)
# windowrule = size 900 700, class:(signal|Signal)
# windowrule = center, class:(signal|Signal)

# Optional: Assign to workspace
# windowrule = workspace 9, class:(signal|Signal)

# Signal settings
windowrulev2 = float, class:(signal|Signal), title:(Settings|Preferences)
windowrulev2 = size 800 600, class:(signal|Signal), title:(Settings|Preferences)

# ============================================================================
# TELEGRAM
# ============================================================================
# Telegram Desktop messaging app

windowrule = opacity 0.98 0.95, class:(org.telegram.desktop|telegram-desktop|TelegramDesktop)

# Optional: Float Telegram
# windowrule = float, class:(org.telegram.desktop)
# windowrule = size 900 700, class:(org.telegram.desktop)

# Optional: Assign to workspace
# windowrule = workspace 9, class:(org.telegram.desktop)

# Telegram media viewer (photos, videos)
windowrulev2 = float, class:(org.telegram.desktop), title:(Media viewer)
windowrulev2 = opacity 1 1, class:(org.telegram.desktop), title:(Media viewer)

# ============================================================================
# ELEMENT (Matrix Client)
# ============================================================================
# Matrix protocol client for decentralized communication

windowrule = opacity 0.98 0.95, class:(Element|element)

# Element calls
windowrulev2 = float, class:(Element), title:(.*call.*)
windowrulev2 = size 400 300, class:(Element), title:(.*call.*)

# ============================================================================
# WHATSAPP / WEB APPS
# ============================================================================
# WhatsApp Web (if run as PWA via browser --app mode)
#   - See browser.conf for web app handling
#   - Class usually matches browser class with initialTitle

# WhatsApp as browser app
windowrulev2 = opacity 0.98 0.95, initialTitle:(WhatsApp)

# Optional: Float WhatsApp
# windowrulev2 = float, initialTitle:(WhatsApp)
# windowrulev2 = size 1000 700, initialTitle:(WhatsApp)

# ============================================================================
# TEAMS / ZOOM / VIDEO CONFERENCING
# ============================================================================

# Microsoft Teams
windowrule = opacity 0.98 0.95, class:(teams|Microsoft Teams)
windowrulev2 = float, class:(teams), title:(Meeting)
windowrulev2 = opacity 1 1, class:(teams), title:(Meeting)
windowrulev2 = idleinhibit focus, class:(teams), title:(Meeting)

# Zoom
windowrule = opacity 1 1, class:(zoom|Zoom)
windowrulev2 = float, class:(zoom), title:(Zoom Meeting)
windowrulev2 = idleinhibit focus, class:(zoom), title:(Zoom Meeting)

# Zoom meeting window (no transparency for video quality)
windowrulev2 = opacity 1 1, class:(zoom), title:(Zoom Meeting)
windowrulev2 = noborder, class:(zoom), title:(Zoom Meeting)

# ============================================================================
# SCREEN SHARING OPTIMIZATIONS
# ============================================================================
# Better performance during screen sharing

# No blur behind communication apps when sharing screen (performance)
# windowrule = noblur, class:(discord|slack|signal|zoom|teams)

# Idle inhibit when screen sharing (prevent sleep/dim)
#   - Most apps handle this themselves
#   - Uncomment if experiencing issues
# windowrule = idleinhibit focus, class:(discord|slack|zoom|teams)

# ============================================================================
# WORKSPACE ORGANIZATION
# ============================================================================
# Organize communication apps on specific workspaces
#   - All on workspace 9 for quick access
#   - Or separate by type

# All communication to workspace 9
# windowrule = workspace 9, class:(discord|slack|signal|telegram|zoom|teams|element)

# Separate workspaces by category
# windowrule = workspace 8, class:(slack|teams)     # Work communication
# windowrule = workspace 9, class:(discord|signal)  # Personal communication

# ============================================================================
# NOTIFICATION WINDOWS
# ============================================================================
# Desktop notifications from communication apps
#   - Usually handled by the notification daemon (mako/dunst)
#   - Apps send via libnotify, not as separate windows

# Note: Notification styling configured in mako/dunst config, not here

# ============================================================================
# PICTURE-IN-PICTURE FOR VIDEO CALLS
# ============================================================================
# Small floating window during video calls

# Discord/Slack video call popout
windowrulev2 = float, class:(discord|slack), title:(.*Video Call.*|.*Screen Share.*)
windowrulev2 = size 400 300, class:(discord|slack), title:(.*Video Call.*|.*Screen Share.*)
windowrulev2 = pin, class:(discord|slack), title:(.*Video Call.*|.*Screen Share.*)

# ============================================================================
# IDLE DETECTION
# ============================================================================
# Communication apps often have away/idle status
#   - They detect idle time themselves
#   - No Hyprland configuration needed
#   - Apps use D-Bus idle detection or X11 idle APIs

# ============================================================================
# AUDIO/VIDEO DEVICE SELECTION
# ============================================================================
# Apps access audio/video through PipeWire/PulseAudio
#   - Selection happens in app settings
#   - No Hyprland configuration
#   - Ensure PipeWire is running (systemctl --user status pipewire)

# ============================================================================
# HOW TO IDENTIFY COMMUNICATION APP WINDOWS
# ============================================================================
# Method 1: Check active window
#   hyprctl activewindow | grep -E "(class|title)"
#
# Method 2: List all app windows
#   hyprctl clients | grep -i discord
#   hyprctl clients | grep -i slack
#
# Common classes:
#   - Discord: discord, Discord, discordcanary, vesktop
#   - Slack: Slack, slack
#   - Signal: signal, Signal
#   - Telegram: org.telegram.desktop, TelegramDesktop
#   - Element: Element, element
#   - Zoom: zoom, Zoom
#   - Teams: teams, Microsoft Teams
#   - WhatsApp (PWA): Check initialTitle

# ============================================================================
# WAYLAND NATIVE VS ELECTRON
# ============================================================================
# Most communication apps are Electron-based:
#   - Discord, Slack, Signal (Electron apps)
#   - Need Wayland flags for native Wayland:
#     --enable-features=UseOzonePlatform,WaylandWindowDecorations
#     --ozone-platform=wayland
#
# These flags usually set via:
#   1. Desktop file (Exec= line)
#   2. Launch script
#   3. ~/.config/electron-flags.conf
#
# envs.conf already sets ELECTRON_OZONE_PLATFORM_HINT=wayland globally

# ============================================================================
# SCREEN SHARING REQUIREMENTS
# ============================================================================
# Wayland screen sharing needs:
#   1. xdg-desktop-portal-hyprland (installed)
#   2. PipeWire (running)
#   3. App support (Discord, Slack, Zoom support varies)
#
# Some apps need:
#   - Chromium flags: --enable-features=WebRTCPipeWireCapturer
#   - Firefox: Set media.navigator.mediadatadecoder_vpx_enabled = true
#
# Test screen sharing: Open app → Share screen → Select window/monitor

# ============================================================================
# TROUBLESHOOTING
# ============================================================================
# Problem: Screen sharing doesn't work
#   Solution: Install xdg-desktop-portal-hyprland, restart app
#
# Problem: Notifications don't show
#   Solution: Check mako/dunst is running, test with notify-send
#
# Problem: Audio doesn't work in calls
#   Solution: Check PipeWire, select correct device in app settings
#
# Problem: App is blurry/laggy
#   Solution: Disable transparency, blur, or ensure Wayland native mode
#
# Problem: App won't stay in workspace
#   Solution: Use workspace rule (uncomment workspace assignments above)

# ============================================================================
# NOTES
# ============================================================================
# Communication app opacity:
#   - 0.98/0.95 is subtle, maintains readability
#   - Can set to 1.0 if transparency affects performance
#
# Idle inhibit:
#   - focus: Prevents sleep when app window is focused
#   - fullscreen: Only prevents sleep when fullscreen
#   - Most apps handle this themselves via D-Bus inhibit
#
# Workspace assignments:
#   - Good for organizing work/personal communication
#   - Makes switching contexts faster (SUPER+9 for chat)
#
# Video call optimization:
#   - No transparency (opacity 1 1) for better quality
#   - Idle inhibit prevents screen sleeping mid-call
#   - Consider noborder for cleaner look

