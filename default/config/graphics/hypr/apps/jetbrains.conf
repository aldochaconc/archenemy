#
# JetBrains IDEs Window Rules
# https://wiki.hyprland.org/Configuring/Window-Rules/
#
# Configuration for JetBrains products: IntelliJ IDEA, PyCharm, WebStorm, etc.
#

# ============================================================================
# JETBRAINS IDE OVERVIEW
# ============================================================================
# JetBrains IDEs (IntelliJ, PyCharm, WebStorm, CLion, etc.) have special quirks:
#   - Multiple popup windows (autocomplete, settings, etc.)
#   - Tab dragging creates temporary unnamed windows
#   - Splash screen on startup
#   - Tool windows (Project, Structure, etc.)
#
# Window class pattern: .*jetbrains.*
# Common classes:
#   - jetbrains-idea: IntelliJ IDEA
#   - jetbrains-pycharm: PyCharm
#   - jetbrains-webstorm: WebStorm
#   - jetbrains-clion: CLion
#   - jetbrains-phpstorm: PhpStorm
#   - jetbrains-rider: Rider
#   - jetbrains-goland: GoLand
#   - jetbrains-rubymine: RubyMine

# ============================================================================
# UNNAMED POPUP WINDOWS
# ============================================================================
# JetBrains creates unnamed windows (title:^$) for various purposes
# These need special sizing to appear correctly

# Default size for unnamed windows
#   - Used for: Settings dialogs, preferences, some popups
#   - 50% screen size is a good default
windowrule = size 50% 50%, class:(.*jetbrains.*)$, title:^$

# Alternative: Larger default for high-res displays
# windowrule = size 60% 60%, class:(.*jetbrains.*)$, title:^$

# ============================================================================
# TAB DRAGGING FIX
# ============================================================================
# When dragging tabs in JetBrains IDEs, a temporary window is created
#   - Title is a single space: title:^\s$
#   - Without this fix: Focus switches to drag preview, breaks drag operation
#   - noinitialfocus: Prevents the drag preview from stealing focus

windowrule = noinitialfocus, class:^(.*jetbrains.*)$, title:^\s$

# ============================================================================
# FOCUS FIXES FOR EMPTY WINDOWS
# ============================================================================
# Some JetBrains popups have no title and should be focusable
#   - Default Hyprland behavior: nofocus for empty windows (see windows.conf)
#   - Override that for JetBrains to allow clicking dialogs

# Allow focus on unnamed JetBrains windows
windowrule = unset,nofocus,class:^(.*jetbrains.*)$,title:^$

# Allow initial focus on unnamed JetBrains windows
windowrule = unset,noinitialfocus,class:^(.*jetbrains.*)$,title:^$

# Note: Tab drag windows (title:^\s$) still have noinitialfocus from rule above

# ============================================================================
# SPLASH SCREEN
# ============================================================================
# JetBrains splash screen on startup
#   - Float and center for better appearance
#   - No animations for faster startup perception

windowrulev2 = float, class:(.*jetbrains.*), title:(splash|Welcome)
windowrulev2 = center, class:(.*jetbrains.*), title:(splash|Welcome)
windowrulev2 = noanim, class:(.*jetbrains.*), title:(splash|Welcome)

# Alternative: Different size for splash
# windowrulev2 = size 600 400, class:(.*jetbrains.*), title:(splash|Welcome)

# ============================================================================
# SETTINGS & DIALOGS
# ============================================================================
# Settings and preference windows

# Float settings dialogs
windowrulev2 = float, class:(.*jetbrains.*), title:(Settings|Preferences)
windowrulev2 = size 60% 70%, class:(.*jetbrains.*), title:(Settings|Preferences)
windowrulev2 = center, class:(.*jetbrains.*), title:(Settings|Preferences)

# Project Structure dialog
windowrulev2 = float, class:(.*jetbrains.*), title:(Project Structure)
windowrulev2 = size 70% 80%, class:(.*jetbrains.*), title:(Project Structure)

# ============================================================================
# TOOL WINDOWS
# ============================================================================
# JetBrains tool windows (Project, Structure, Terminal, etc.)
#   - Usually docked to main window
#   - If detached, they should float

# Detached tool windows
# windowrulev2 = float, class:(.*jetbrains.*), title:(Project|Structure|TODO|Problems)

# ============================================================================
# FIND/REPLACE DIALOGS
# ============================================================================
# Search dialogs should float over main window

windowrulev2 = float, class:(.*jetbrains.*), title:(Find|Replace|Search)
windowrulev2 = size 800 200, class:(.*jetbrains.*), title:(Find|Replace)
windowrulev2 = size 900 600, class:(.*jetbrains.*), title:(Search Everywhere|Find in Path)

# ============================================================================
# RUN/DEBUG CONFIGURATIONS
# ============================================================================
# Configuration dialogs for running and debugging

windowrulev2 = float, class:(.*jetbrains.*), title:(Run.*Configuration|Debug.*Configuration|Edit Configuration)
windowrulev2 = size 60% 50%, class:(.*jetbrains.*), title:(Run.*Configuration|Debug.*Configuration|Edit Configuration)

# ============================================================================
# VCS (VERSION CONTROL) POPUPS
# ============================================================================
# Git, SVN, Mercurial dialogs

windowrulev2 = float, class:(.*jetbrains.*), title:(Commit|Push|Pull|Merge|Rebase|Stash)
windowrulev2 = size 800 600, class:(.*jetbrains.*), title:(Commit|Push|Pull)

# ============================================================================
# REFACTORING DIALOGS
# ============================================================================
# Refactoring operation dialogs

windowrulev2 = float, class:(.*jetbrains.*), title:(Rename|Extract|Inline|Move|Copy)
windowrulev2 = size 600 400, class:(.*jetbrains.*), title:(Rename|Extract|Inline|Move|Copy)

# ============================================================================
# MAIN EDITOR WINDOWS
# ============================================================================
# Main IDE windows (editor, not dialogs)
#   - Usually want these tiled for maximum screen space
#   - No special rules needed, will tile by default

# Optional: Force tile (if you've set IDEs to float globally)
# windowrulev2 = tile, class:(.*jetbrains.*), title:^(?!.*Settings|.*Preferences|.*Configuration).*$

# ============================================================================
# OPACITY SETTINGS (Optional)
# ============================================================================
# IDEs usually benefit from being fully opaque for code readability

windowrule = opacity 1 1, class:(.*jetbrains.*)

# ============================================================================
# WORKSPACE ASSIGNMENT (Optional)
# ============================================================================
# Assign JetBrains IDEs to specific workspace

# All JetBrains IDEs to workspace 2 (uncomment if desired)
# windowrule = workspace 2, class:(.*jetbrains.*)

# ============================================================================
# IDE-SPECIFIC RULES
# ============================================================================
# Rules for specific JetBrains products if needed

# IntelliJ IDEA
# windowrule = workspace 2, class:(jetbrains-idea)

# PyCharm
# windowrule = workspace 3, class:(jetbrains-pycharm)

# WebStorm
# windowrule = workspace 4, class:(jetbrains-webstorm)

# ============================================================================
# ANDROID STUDIO
# ============================================================================
# Android Studio (based on IntelliJ) needs similar rules

windowrule = size 50% 50%, class:(jetbrains-studio)$, title:^$
windowrule = noinitialfocus, class:^(jetbrains-studio)$, title:^\s$
windowrule = unset,nofocus,class:^(jetbrains-studio)$,title:^$
windowrule = unset,noinitialfocus,class:^(jetbrains-studio)$,title:^$
windowrule = opacity 1 1, class:(jetbrains-studio)

# Android Emulator windows
windowrulev2 = float, class:(jetbrains-studio), title:(Emulator)
windowrulev2 = size 400 800, class:(jetbrains-studio), title:(Emulator)

# ============================================================================
# JETBRAINS TOOLBOX
# ============================================================================
# JetBrains Toolbox App (IDE launcher)

windowrule = float, class:(jetbrains-toolbox)
windowrule = size 600 700, class:(jetbrains-toolbox)
windowrule = center, class:(jetbrains-toolbox)

# ============================================================================
# PERFORMANCE CONSIDERATIONS
# ============================================================================
# JetBrains IDEs are resource-intensive
#   - Consider disabling blur for better performance
#   - No animations for faster window operations

# Disable blur for JetBrains windows (optional, for performance)
# windowrule = noblur, class:(.*jetbrains.*)

# Faster animations for popups (optional)
# windowrule = animation slide, class:(.*jetbrains.*)

# ============================================================================
# IDLE INHIBIT (Optional)
# ============================================================================
# Prevent sleep during long builds or debugging sessions

# Inhibit idle when JetBrains IDE is focused (optional)
# windowrule = idleinhibit focus, class:(.*jetbrains.*)

# ============================================================================
# HOW TO IDENTIFY JETBRAINS WINDOWS
# ============================================================================
# Method 1: Check active window while IDE is focused
#   hyprctl activewindow | grep -E "(class|title)"
#
# Method 2: List all IDE windows
#   hyprctl clients | grep -A 10 "jetbrains"
#
# Method 3: Monitor window events while using IDE
#   hyprctl events | grep -E "openwindow|closewindow"
#
# Common window patterns:
#   - Main window: title = project name or "IntelliJ IDEA"
#   - Settings: title = "Settings" or "Preferences"
#   - Unnamed: title = "" (empty)
#   - Drag windows: title = " " (single space)
#   - Splash: title = "splash" or "Welcome to X"

# ============================================================================
# TROUBLESHOOTING
# ============================================================================
# Problem: Can't click on dialogs
#   Solution: Ensure focus unset rules are applied (lines 62-67)
#
# Problem: Tab dragging doesn't work
#   Solution: Check noinitialfocus rule for title:^\s$ (line 56)
#
# Problem: Popups are wrong size
#   Solution: Adjust size rule for title:^$ windows (line 34)
#
# Problem: Settings dialog too small
#   Solution: Increase percentage in Settings rule (line 86)
#
# Problem: IDE is slow/laggy
#   Solution: Disable blur and/or animations (lines 195-200)

# ============================================================================
# NOTES
# ============================================================================
# JetBrains window behavior:
#   - Creates many temporary windows during operation
#   - Uses empty titles for some popups (requires special handling)
#   - Tab dragging creates windows with single-space title
#   - Tool windows can be docked or floating
#
# Regex patterns:
#   - .*jetbrains.*: Matches any JetBrains product
#   - ^$: Empty title (no characters)
#   - ^\s$: Title with only whitespace (single space)
#
# Priority of rules:
#   - More specific rules (with title:) override general ones
#   - Later rules override earlier ones for same criteria
#   - unset rules remove previously set properties

